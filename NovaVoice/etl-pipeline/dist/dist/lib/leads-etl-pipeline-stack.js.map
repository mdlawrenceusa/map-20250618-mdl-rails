{"version":3,"file":"leads-etl-pipeline-stack.js","sourceRoot":"","sources":["../../lib/leads-etl-pipeline-stack.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LeadsETLPipelineStack = void 0;\nconst cdk = __importStar(require(\"aws-cdk-lib\"));\nconst s3 = __importStar(require(\"aws-cdk-lib/aws-s3\"));\nconst dynamodb = __importStar(require(\"aws-cdk-lib/aws-dynamodb\"));\nconst lambda = __importStar(require(\"aws-cdk-lib/aws-lambda\"));\nconst iam = __importStar(require(\"aws-cdk-lib/aws-iam\"));\nconst stepfunctions = __importStar(require(\"aws-cdk-lib/aws-stepfunctions\"));\nconst sfnTasks = __importStar(require(\"aws-cdk-lib/aws-stepfunctions-tasks\"));\nconst glue = __importStar(require(\"@aws-cdk/aws-glue-alpha\"));\nconst sns = __importStar(require(\"aws-cdk-lib/aws-sns\"));\nconst snsSubscriptions = __importStar(require(\"aws-cdk-lib/aws-sns-subscriptions\"));\nconst cloudwatch = __importStar(require(\"aws-cdk-lib/aws-cloudwatch\"));\nconst path = __importStar(require(\"path\"));\nclass LeadsETLPipelineStack extends cdk.Stack {\n    constructor(scope, id, props) {\n        super(scope, id, props);\n        // Configuration\n        const sourceBucket = props?.sourceBucket || 'globaloutreachevent.com';\n        const sourceKey = props?.sourceKey || 'leads.txt';\n        const notificationEmail = props?.notificationEmail || '';\n        // Create output bucket for processed data\n        const outputBucket = new s3.Bucket(this, 'LeadsProcessedOutput', {\n            bucketName: `leads-processed-output-${this.account}-${this.region}`,\n            versioned: true,\n            encryption: s3.BucketEncryption.S3_MANAGED,\n            removalPolicy: cdk.RemovalPolicy.RETAIN,\n            lifecycleRules: [\n                {\n                    id: 'DeleteOldProcessedFiles',\n                    expiration: cdk.Duration.days(90),\n                    prefix: 'processed/'\n                }\n            ]\n        });\n        // Create scripts bucket for Glue scripts\n        const scriptsBucket = new s3.Bucket(this, 'GlueScriptsBucket', {\n            bucketName: `glue-scripts-${this.account}-${this.region}`,\n            versioned: true,\n            encryption: s3.BucketEncryption.S3_MANAGED,\n            removalPolicy: cdk.RemovalPolicy.DESTROY,\n            autoDeleteObjects: true\n        });\n        // Create DynamoDB table with phone as primary key\n        const churchesTable = new dynamodb.Table(this, 'ChurchesTable', {\n            tableName: 'Churches',\n            partitionKey: { name: 'phone', type: dynamodb.AttributeType.STRING },\n            billingMode: dynamodb.BillingMode.ON_DEMAND,\n            pointInTimeRecovery: true,\n            removalPolicy: cdk.RemovalPolicy.RETAIN,\n            encryption: dynamodb.TableEncryption.AWS_MANAGED,\n            stream: dynamodb.StreamViewType.NEW_AND_OLD_IMAGES // Enable DynamoDB Streams for change tracking\n        });\n        // Add Global Secondary Indexes\n        churchesTable.addGlobalSecondaryIndex({\n            indexName: 'lead_status-index',\n            partitionKey: { name: 'lead_status', type: dynamodb.AttributeType.STRING },\n            projectionType: dynamodb.ProjectionType.ALL\n        });\n        churchesTable.addGlobalSecondaryIndex({\n            indexName: 'owner_alias-index',\n            partitionKey: { name: 'owner_alias', type: dynamodb.AttributeType.STRING },\n            projectionType: dynamodb.ProjectionType.ALL\n        });\n        // Create Glue IAM role\n        const glueRole = new iam.Role(this, 'GlueETLRole', {\n            assumedBy: new iam.ServicePrincipal('glue.amazonaws.com'),\n            managedPolicies: [\n                iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSGlueServiceRole')\n            ]\n        });\n        // Grant Glue access to S3 buckets\n        glueRole.addToPolicy(new iam.PolicyStatement({\n            actions: ['s3:GetObject', 's3:ListBucket'],\n            resources: [\n                `arn:aws:s3:::${sourceBucket}`,\n                `arn:aws:s3:::${sourceBucket}/*`\n            ]\n        }));\n        outputBucket.grantReadWrite(glueRole);\n        scriptsBucket.grantRead(glueRole);\n        // Create Glue job\n        const glueJob = new glue.Job(this, 'LeadsParserJob', {\n            jobName: 'leads-parser-job',\n            role: glueRole,\n            executable: glue.JobExecutable.pythonEtl({\n                glueVersion: glue.GlueVersion.V4_0,\n                pythonVersion: glue.PythonVersion.THREE,\n                script: glue.Code.fromAsset(path.join(__dirname, '../glue-scripts/parse-leads.py'))\n            }),\n            defaultArguments: {\n                '--SOURCE_BUCKET': sourceBucket,\n                '--SOURCE_KEY': sourceKey,\n                '--OUTPUT_BUCKET': outputBucket.bucketName,\n                '--enable-metrics': '',\n                '--enable-continuous-cloudwatch-log': 'true',\n                '--enable-spark-ui': 'true',\n                '--spark-event-logs-path': `s3://${outputBucket.bucketName}/spark-logs/`\n            },\n            maxRetries: 2,\n            timeout: cdk.Duration.minutes(30),\n            maxConcurrentRuns: 1\n        });\n        // Create Lambda functions\n        const lambdaRole = new iam.Role(this, 'LambdaETLRole', {\n            assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),\n            managedPolicies: [\n                iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSLambdaBasicExecutionRole')\n            ]\n        });\n        outputBucket.grantRead(lambdaRole);\n        churchesTable.grantReadWriteData(lambdaRole);\n        // DynamoDB Loader Lambda\n        const dynamoLoaderLambda = new lambda.Function(this, 'DynamoLoaderFunction', {\n            functionName: 'leads-dynamo-loader',\n            runtime: lambda.Runtime.NODEJS_18_X,\n            handler: 'index.handler',\n            code: lambda.Code.fromAsset(path.join(__dirname, '../lambda/dynamo-loader')),\n            role: lambdaRole,\n            timeout: cdk.Duration.minutes(15),\n            memorySize: 1024,\n            environment: {\n                TABLE_NAME: churchesTable.tableName,\n                OUTPUT_BUCKET: outputBucket.bucketName\n            }\n        });\n        // Rails Seeds Generator Lambda\n        const seedsGeneratorLambda = new lambda.Function(this, 'SeedsGeneratorFunction', {\n            functionName: 'rails-seeds-generator',\n            runtime: lambda.Runtime.NODEJS_18_X,\n            handler: 'index.handler',\n            code: lambda.Code.fromAsset(path.join(__dirname, '../lambda/seeds-generator')),\n            role: lambdaRole,\n            timeout: cdk.Duration.minutes(10),\n            memorySize: 512,\n            environment: {\n                OUTPUT_BUCKET: outputBucket.bucketName\n            }\n        });\n        // Data Validation Lambda\n        const validationLambda = new lambda.Function(this, 'DataValidationFunction', {\n            functionName: 'leads-data-validation',\n            runtime: lambda.Runtime.NODEJS_18_X,\n            handler: 'index.handler',\n            code: lambda.Code.fromAsset(path.join(__dirname, '../lambda/data-validation')),\n            role: lambdaRole,\n            timeout: cdk.Duration.minutes(5),\n            memorySize: 256,\n            environment: {\n                TABLE_NAME: churchesTable.tableName,\n                OUTPUT_BUCKET: outputBucket.bucketName\n            }\n        });\n        // Create SNS topic for notifications\n        const notificationTopic = new sns.Topic(this, 'ETLNotificationTopic', {\n            topicName: 'leads-etl-notifications',\n            displayName: 'Leads ETL Pipeline Notifications'\n        });\n        if (notificationEmail) {\n            notificationTopic.addSubscription(new snsSubscriptions.EmailSubscription(notificationEmail));\n        }\n        // Create Step Functions state machine\n        const glueTask = new sfnTasks.GlueStartJobRun(this, 'RunGlueETL', {\n            glueJobName: glueJob.jobName,\n            integrationPattern: stepfunctions.IntegrationPattern.RUN_JOB,\n            resultPath: '$.glueResult'\n        });\n        const dynamoLoaderTask = new sfnTasks.LambdaInvoke(this, 'LoadToDynamoDB', {\n            lambdaFunction: dynamoLoaderLambda,\n            outputPath: '$.Payload',\n            retryOnServiceExceptions: true\n        });\n        const seedsGeneratorTask = new sfnTasks.LambdaInvoke(this, 'GenerateRailsSeeds', {\n            lambdaFunction: seedsGeneratorLambda,\n            outputPath: '$.Payload',\n            retryOnServiceExceptions: true\n        });\n        const validationTask = new sfnTasks.LambdaInvoke(this, 'ValidateData', {\n            lambdaFunction: validationLambda,\n            outputPath: '$.Payload',\n            retryOnServiceExceptions: true\n        });\n        const successNotification = new sfnTasks.SnsPublish(this, 'SendSuccessNotification', {\n            topic: notificationTopic,\n            message: stepfunctions.TaskInput.fromText('ETL Pipeline completed successfully!')\n        });\n        const failureNotification = new sfnTasks.SnsPublish(this, 'SendFailureNotification', {\n            topic: notificationTopic,\n            message: stepfunctions.TaskInput.fromJsonPathAt('$.error')\n        });\n        // Define the workflow\n        const definition = glueTask\n            .next(dynamoLoaderTask)\n            .next(new stepfunctions.Parallel(this, 'ParallelProcessing')\n            .branch(seedsGeneratorTask)\n            .branch(validationTask))\n            .next(successNotification);\n        // Add error handling\n        const errorHandler = new stepfunctions.Fail(this, 'ETLFailed', {\n            error: 'ETLPipelineError',\n            cause: 'Check CloudWatch Logs for details'\n        });\n        definition.addCatch(failureNotification.next(errorHandler), {\n            errors: ['States.ALL'],\n            resultPath: '$.error'\n        });\n        const stateMachine = new stepfunctions.StateMachine(this, 'LeadsETLStateMachine', {\n            stateMachineName: 'leads-etl-pipeline',\n            definition,\n            timeout: cdk.Duration.hours(2),\n            tracingEnabled: true\n        });\n        // Create CloudWatch Dashboard\n        const dashboard = new cloudwatch.Dashboard(this, 'ETLDashboard', {\n            dashboardName: 'leads-etl-pipeline-dashboard'\n        });\n        dashboard.addWidgets(new cloudwatch.GraphWidget({\n            title: 'Lambda Function Duration',\n            width: 12,\n            height: 6,\n            left: [\n                dynamoLoaderLambda.metricDuration(),\n                seedsGeneratorLambda.metricDuration(),\n                validationLambda.metricDuration()\n            ]\n        }), new cloudwatch.GraphWidget({\n            title: 'DynamoDB Write Throttles',\n            width: 12,\n            height: 6,\n            left: [\n                churchesTable.metricUserErrors()\n            ]\n        }));\n        // Outputs\n        new cdk.CfnOutput(this, 'OutputBucketName', {\n            value: outputBucket.bucketName,\n            description: 'S3 bucket for processed output files'\n        });\n        new cdk.CfnOutput(this, 'DynamoTableName', {\n            value: churchesTable.tableName,\n            description: 'DynamoDB table name for church leads'\n        });\n        new cdk.CfnOutput(this, 'StateMachineArn', {\n            value: stateMachine.stateMachineArn,\n            description: 'Step Functions state machine ARN'\n        });\n    }\n}\nexports.LeadsETLPipelineStack = LeadsETLPipelineStack;\n//# sourceMappingURL=leads-etl-pipeline-stack.js.map"]}