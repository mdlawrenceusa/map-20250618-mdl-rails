{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.202.0"},"children":{"LeadsETLPipelineStack":{"id":"LeadsETLPipelineStack","path":"LeadsETLPipelineStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.202.0"},"children":{"LeadsProcessedOutput":{"id":"LeadsProcessedOutput","path":"LeadsETLPipelineStack/LeadsProcessedOutput","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LeadsProcessedOutput/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"leads-processed-output-302296110959-us-east-1","lifecycleConfiguration":{"rules":[{"expirationInDays":90,"id":"DeleteOldProcessedFiles","prefix":"processed/","status":"Enabled"}]},"versioningConfiguration":{"status":"Enabled"}}}}}},"GlueScriptsBucket":{"id":"GlueScriptsBucket","path":"LeadsETLPipelineStack/GlueScriptsBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/GlueScriptsBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"glue-scripts-302296110959-us-east-1","tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"aws-cdk:cr-owned:scripts/:e7c7bd22","value":"true"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"LeadsETLPipelineStack/GlueScriptsBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/GlueScriptsBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"GlueScriptsBucketCD60B14C"},"policyDocument":{"Statement":[{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"LeadsETLPipelineStack/GlueScriptsBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.202.0","metadata":[]},"children":{"Default":{"id":"Default","path":"LeadsETLPipelineStack/GlueScriptsBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"LeadsETLPipelineStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.202.0"},"children":{"Staging":{"id":"Staging","path":"LeadsETLPipelineStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"Role":{"id":"Role","path":"LeadsETLPipelineStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}},"Handler":{"id":"Handler","path":"LeadsETLPipelineStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}},"ChurchesTable":{"id":"ChurchesTable","path":"LeadsETLPipelineStack/ChurchesTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/ChurchesTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"phone","attributeType":"S"},{"attributeName":"lead_status","attributeType":"S"},{"attributeName":"owner_alias","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"lead_status-index","keySchema":[{"attributeName":"lead_status","keyType":"HASH"}],"projection":{"projectionType":"ALL"}},{"indexName":"owner_alias-index","keySchema":[{"attributeName":"owner_alias","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"phone","keyType":"HASH"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":true},"sseSpecification":{"sseEnabled":true},"streamSpecification":{"streamViewType":"NEW_AND_OLD_IMAGES"},"tableName":"Churches"}}},"ScalingRole":{"id":"ScalingRole","path":"LeadsETLPipelineStack/ChurchesTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":[]}}}},"GlueETLRole":{"id":"GlueETLRole","path":"LeadsETLPipelineStack/GlueETLRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[]},"children":{"ImportGlueETLRole":{"id":"ImportGlueETLRole","path":"LeadsETLPipelineStack/GlueETLRole/ImportGlueETLRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":[]}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/GlueETLRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"glue.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSGlueServiceRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"LeadsETLPipelineStack/GlueETLRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/GlueETLRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject","s3:ListBucket"],"Effect":"Allow","Resource":["arn:aws:s3:::globaloutreachevent.com","arn:aws:s3:::globaloutreachevent.com/*"]},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["LeadsProcessedOutputC85726B7","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["LeadsProcessedOutputC85726B7","Arn"]},"/*"]]}]},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"GlueETLRoleDefaultPolicy5E2EA745","roles":[{"Ref":"GlueETLRoleD6A3A0E8"}]}}}}}}},"GlueScriptDeployment":{"id":"GlueScriptDeployment","path":"LeadsETLPipelineStack/GlueScriptDeployment","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_deployment.BucketDeployment","version":"2.202.0"},"children":{"AwsCliLayer":{"id":"AwsCliLayer","path":"LeadsETLPipelineStack/GlueScriptDeployment/AwsCliLayer","constructInfo":{"fqn":"aws-cdk-lib.lambda_layer_awscli.AwsCliLayer","version":"2.202.0","metadata":[]},"children":{"Code":{"id":"Code","path":"LeadsETLPipelineStack/GlueScriptDeployment/AwsCliLayer/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/GlueScriptDeployment/AwsCliLayer/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/GlueScriptDeployment/AwsCliLayer/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/GlueScriptDeployment/AwsCliLayer/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnLayerVersion","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::LayerVersion","aws:cdk:cloudformation:props":{"content":{"s3Bucket":"cdk-hnb659fds-assets-302296110959-us-east-1","s3Key":"1b2c92f2cd21c170884393633bd4c732676df6290562199b6e3ca5e2a1be7d18.zip"},"description":"/opt/awscli/aws"}}}}},"CustomResourceHandler":{"id":"CustomResourceHandler","path":"LeadsETLPipelineStack/GlueScriptDeployment/CustomResourceHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.202.0","metadata":[]}},"Asset1":{"id":"Asset1","path":"LeadsETLPipelineStack/GlueScriptDeployment/Asset1","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/GlueScriptDeployment/Asset1/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/GlueScriptDeployment/Asset1/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"CustomResource":{"id":"CustomResource","path":"LeadsETLPipelineStack/GlueScriptDeployment/CustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.202.0","metadata":[]},"children":{"Default":{"id":"Default","path":"LeadsETLPipelineStack/GlueScriptDeployment/CustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}}}},"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C":{"id":"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.202.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":[]}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::cdk-hnb659fds-assets-302296110959-us-east-1"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::cdk-hnb659fds-assets-302296110959-us-east-1/*"]]}]},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["GlueScriptsBucketCD60B14C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF","roles":[{"Ref":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265"}]}}}}}}},"Code":{"id":"Code","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-302296110959-us-east-1","s3Key":"9a1fcb4a7ecba81ad70e9d3fb241f6794497da945dae5f25924e4dd002b65f2d.zip"},"environment":{"variables":{"AWS_CA_BUNDLE":"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem"}},"handler":"index.handler","layers":[{"Ref":"GlueScriptDeploymentAwsCliLayer5E81A6C7"}],"role":{"Fn::GetAtt":["CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265","Arn"]},"runtime":"python3.11","timeout":900}}}}},"LeadsParserJob":{"id":"LeadsParserJob","path":"LeadsETLPipelineStack/LeadsParserJob","constructInfo":{"fqn":"aws-cdk-lib.aws_glue.CfnJob","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Glue::Job","aws:cdk:cloudformation:props":{"command":{"name":"glueetl","pythonVersion":"3","scriptLocation":{"Fn::Join":["",["s3://",{"Ref":"GlueScriptsBucketCD60B14C"},"/scripts/parse-leads.py"]]}},"defaultArguments":{"--SOURCE_BUCKET":"globaloutreachevent.com","--SOURCE_KEY":"leads.txt","--OUTPUT_BUCKET":{"Ref":"LeadsProcessedOutputC85726B7"},"--enable-metrics":"","--enable-continuous-cloudwatch-log":"true","--enable-spark-ui":"true","--spark-event-logs-path":{"Fn::Join":["",["s3://",{"Ref":"LeadsProcessedOutputC85726B7"},"/spark-logs/"]]},"--job-language":"python"},"executionProperty":{"maxConcurrentRuns":1},"glueVersion":"4.0","maxRetries":2,"name":"leads-parser-job","role":{"Fn::GetAtt":["GlueETLRoleD6A3A0E8","Arn"]},"timeout":30}}},"LambdaETLRole":{"id":"LambdaETLRole","path":"LeadsETLPipelineStack/LambdaETLRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[]},"children":{"ImportLambdaETLRole":{"id":"ImportLambdaETLRole","path":"LeadsETLPipelineStack/LambdaETLRole/ImportLambdaETLRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":[]}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LambdaETLRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"LeadsETLPipelineStack/LambdaETLRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LambdaETLRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["LeadsProcessedOutputC85726B7","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["LeadsProcessedOutputC85726B7","Arn"]},"/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ChurchesTableBCC5909B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ChurchesTableBCC5909B","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"LambdaETLRoleDefaultPolicy84F253C6","roles":[{"Ref":"LambdaETLRole09759C96"}]}}}}}}},"DynamoLoaderFunction":{"id":"DynamoLoaderFunction","path":"LeadsETLPipelineStack/DynamoLoaderFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.202.0","metadata":[]},"children":{"Code":{"id":"Code","path":"LeadsETLPipelineStack/DynamoLoaderFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/DynamoLoaderFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/DynamoLoaderFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/DynamoLoaderFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-302296110959-us-east-1","s3Key":"1527932aba2a0619ad0e7c1c90959a4f48010d2e0fabf5f4928999bf546df45d.zip"},"environment":{"variables":{"TABLE_NAME":{"Ref":"ChurchesTableBCC5909B"},"OUTPUT_BUCKET":{"Ref":"LeadsProcessedOutputC85726B7"}}},"functionName":"leads-dynamo-loader","handler":"index.handler","memorySize":1024,"role":{"Fn::GetAtt":["LambdaETLRole09759C96","Arn"]},"runtime":"nodejs20.x","timeout":900}}}}},"SeedsGeneratorFunction":{"id":"SeedsGeneratorFunction","path":"LeadsETLPipelineStack/SeedsGeneratorFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.202.0","metadata":[]},"children":{"Code":{"id":"Code","path":"LeadsETLPipelineStack/SeedsGeneratorFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/SeedsGeneratorFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/SeedsGeneratorFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/SeedsGeneratorFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-302296110959-us-east-1","s3Key":"43f4cc18a78a626642e653657b2931a4da902df311816f2afb31e1ca0f947183.zip"},"environment":{"variables":{"OUTPUT_BUCKET":{"Ref":"LeadsProcessedOutputC85726B7"}}},"functionName":"rails-seeds-generator","handler":"index.handler","memorySize":512,"role":{"Fn::GetAtt":["LambdaETLRole09759C96","Arn"]},"runtime":"nodejs20.x","timeout":600}}}}},"DataValidationFunction":{"id":"DataValidationFunction","path":"LeadsETLPipelineStack/DataValidationFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.202.0","metadata":[]},"children":{"Code":{"id":"Code","path":"LeadsETLPipelineStack/DataValidationFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"LeadsETLPipelineStack/DataValidationFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"LeadsETLPipelineStack/DataValidationFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/DataValidationFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-302296110959-us-east-1","s3Key":"f05a48e519f3c4a469d7a9c72e385a4942fcded3c3c291d1b3134e7fe47376d5.zip"},"environment":{"variables":{"TABLE_NAME":{"Ref":"ChurchesTableBCC5909B"},"OUTPUT_BUCKET":{"Ref":"LeadsProcessedOutputC85726B7"}}},"functionName":"leads-data-validation","handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["LambdaETLRole09759C96","Arn"]},"runtime":"nodejs20.x","timeout":300}}}}},"ETLNotificationTopic":{"id":"ETLNotificationTopic","path":"LeadsETLPipelineStack/ETLNotificationTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/ETLNotificationTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Leads ETL Pipeline Notifications","topicName":"leads-etl-notifications"}}}}},"RunGlueETL":{"id":"RunGlueETL","path":"LeadsETLPipelineStack/RunGlueETL","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.GlueStartJobRun","version":"2.202.0"}},"LoadToDynamoDB":{"id":"LoadToDynamoDB","path":"LeadsETLPipelineStack/LoadToDynamoDB","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.202.0"}},"GenerateRailsSeeds":{"id":"GenerateRailsSeeds","path":"LeadsETLPipelineStack/GenerateRailsSeeds","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.202.0"}},"ValidateData":{"id":"ValidateData","path":"LeadsETLPipelineStack/ValidateData","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.202.0"}},"SendSuccessNotification":{"id":"SendSuccessNotification","path":"LeadsETLPipelineStack/SendSuccessNotification","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.SnsPublish","version":"2.202.0"}},"SendFailureNotification":{"id":"SendFailureNotification","path":"LeadsETLPipelineStack/SendFailureNotification","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.SnsPublish","version":"2.202.0"}},"ParallelProcessing":{"id":"ParallelProcessing","path":"LeadsETLPipelineStack/ParallelProcessing","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Parallel","version":"2.202.0"}},"ETLFailed":{"id":"ETLFailed","path":"LeadsETLPipelineStack/ETLFailed","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Fail","version":"2.202.0"}},"ETLPipelineWithErrorHandling":{"id":"ETLPipelineWithErrorHandling","path":"LeadsETLPipelineStack/ETLPipelineWithErrorHandling","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Parallel","version":"2.202.0"}},"LeadsETLStateMachine":{"id":"LeadsETLStateMachine","path":"LeadsETLPipelineStack/LeadsETLStateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.202.0","metadata":[]},"children":{"Role":{"id":"Role","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":[]}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sns:Publish","Effect":"Allow","Resource":{"Ref":"ETLNotificationTopicD458CA32"}},{"Action":["glue:StartJobRun","glue:GetJobRun","glue:GetJobRuns","glue:BatchStopJobRun"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":glue:us-east-1:302296110959:job/leads-parser-job"]]}},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["DynamoLoaderFunctionDDDB5041","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DynamoLoaderFunctionDDDB5041","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["SeedsGeneratorFunction48889090","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SeedsGeneratorFunction48889090","Arn"]},":*"]]}]},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["DataValidationFunction54FE76C7","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DataValidationFunction54FE76C7","Arn"]},":*"]]}]},{"Action":["xray:PutTraceSegments","xray:PutTelemetryRecords","xray:GetSamplingRules","xray:GetSamplingTargets"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LeadsETLStateMachineRoleDefaultPolicyCC7C16D2","roles":[{"Ref":"LeadsETLStateMachineRole3BC10384"}]}}}}}}},"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/LeadsETLStateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"ETLPipelineWithErrorHandling\",\"States\":{\"ETLPipelineWithErrorHandling\":{\"Type\":\"Parallel\",\"End\":true,\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"SendFailureNotification\"}],\"Branches\":[{\"StartAt\":\"RunGlueETL\",\"States\":{\"RunGlueETL\":{\"Next\":\"LoadToDynamoDB\",\"Type\":\"Task\",\"ResultPath\":\"$.glueResult\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::glue:startJobRun.sync\",\"Parameters\":{\"JobName\":\"leads-parser-job\"}},\"LoadToDynamoDB\":{\"Next\":\"ParallelProcessing\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["DynamoLoaderFunctionDDDB5041","Arn"]},"\",\"Payload.$\":\"$\"}},\"ParallelProcessing\":{\"Type\":\"Parallel\",\"Next\":\"SendSuccessNotification\",\"Branches\":[{\"StartAt\":\"GenerateRailsSeeds\",\"States\":{\"GenerateRailsSeeds\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["SeedsGeneratorFunction48889090","Arn"]},"\",\"Payload.$\":\"$\"}}}},{\"StartAt\":\"ValidateData\",\"States\":{\"ValidateData\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["DataValidationFunction54FE76C7","Arn"]},"\",\"Payload.$\":\"$\"}}}}]},\"SendSuccessNotification\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::sns:publish\",\"Parameters\":{\"TopicArn\":\"",{"Ref":"ETLNotificationTopicD458CA32"},"\",\"Message\":\"ETL Pipeline completed successfully!\"}}}}]},\"SendFailureNotification\":{\"Next\":\"ETLFailed\",\"Type\":\"Task\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::sns:publish\",\"Parameters\":{\"TopicArn\":\"",{"Ref":"ETLNotificationTopicD458CA32"},"\",\"Message.$\":\"$.error\"}},\"ETLFailed\":{\"Type\":\"Fail\",\"Error\":\"ETLPipelineError\",\"Cause\":\"Check CloudWatch Logs for details\"}},\"TimeoutSeconds\":7200}"]]},"roleArn":{"Fn::GetAtt":["LeadsETLStateMachineRole3BC10384","Arn"]},"stateMachineName":"leads-etl-pipeline","tracingConfiguration":{"enabled":true}}}}}},"ETLDashboard":{"id":"ETLDashboard","path":"LeadsETLPipelineStack/ETLDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.202.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LeadsETLPipelineStack/ETLDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Lambda Function Duration\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",{"Ref":"DynamoLoaderFunctionDDDB5041"},"\"],[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",{"Ref":"SeedsGeneratorFunction48889090"},"\"],[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",{"Ref":"DataValidationFunction54FE76C7"},"\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"DynamoDB Write Throttles\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/DynamoDB\",\"UserErrors\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}}]}"]]},"dashboardName":"leads-etl-pipeline-dashboard"}}}}},"OutputBucketName":{"id":"OutputBucketName","path":"LeadsETLPipelineStack/OutputBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"DynamoTableName":{"id":"DynamoTableName","path":"LeadsETLPipelineStack/DynamoTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"StateMachineArn":{"id":"StateMachineArn","path":"LeadsETLPipelineStack/StateMachineArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"LeadsETLPipelineStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"LeadsETLPipelineStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"LeadsETLPipelineStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.202.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"LeadsETLPipelineStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.202.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}